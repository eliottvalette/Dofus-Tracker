<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOFUS HDV - Analyse des Prix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/svg+xml" href="dofus-logo.svg">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="header-section">
            <div class="col-12">
                <div class="header-content">
                    <div class="d-flex align-items-center">
                        <img src="dofus-logo.svg" alt="DOFUS Logo" class="dofus-logo me-3">
                        <h1>DOFUS HDV Analytics</h1>
                    </div>
                    <div class="header-stats">
                        <div class="stat-item">
                            <i class="fas fa-box text-success"></i>
                            <span id="totalItems">0</span> Items
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-database text-info"></i>
                            <span id="totalRecords">0</span> Records
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-clock text-warning"></i>
                            <span id="lastUpdate">Never</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-calendar-alt text-primary"></i>
                            <span id="currentTimestamp">Analyse: Dernière tranche</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Search -->
                <div class="search-section">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Rechercher un item...">
                    </div>
                </div>

                <!-- Filters -->
                <div class="filter-section">
                    <h5><i class="fas fa-filter me-2"></i>Filtres</h5>
                    
                    <div class="filter-group">
                        <label>Catégorie</label>
                        <select id="categoryFilter" class="form-select">
                            <option value="">Toutes les catégories</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label>Opportunités d'arbitrage</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="profitableOnly">
                            <label class="form-check-label" for="profitableOnly">
                                Uniquement les opportunités rentables
                            </label>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label>Coût investissement maximum</label>
                        <input type="number" id="maxInvestmentFilter" class="form-control" placeholder="Fixez un coût maximum">
                    </div>
                    <div class="filter-group">
                        <label>Profit % minimum</label>
                        <input type="number" id="minProfitPercentFilter" class="form-control" placeholder="Fixez un % minimum">
                    </div>
                    <div class="filter-group">
                        <label>Profit % maximum</label>
                        <input type="number" id="maxProfitFilter" class="form-control" placeholder="Fixez un profit maximum">
                    </div>
                    <div class="filter-group">
                        <label>Profit minimum (₭)</label>
                        <input type="number" id="minProfitAmountFilter" class="form-control" placeholder="Fixez un profit minimum">
                    </div>
                    <div class="filter-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="hideNoArbitrage">
                            <label class="form-check-label" for="hideNoArbitrage">
                                Masquer les items sans arbitrage
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Panel -->
            <div class="content-area">
                <!-- Quick Stats Cards -->
                <div class="stats-cards">
                    <div class="stat-card profit-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalProfitOpp">0</h3>
                            <p>Opportunités de profit</p>
                        </div>
                    </div>
                    <div class="stat-card volume-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="avgVolume">0</h3>
                            <p>Volume moyen</p>
                        </div>
                    </div>
                    <div class="stat-card price-card">
                        <div class="stat-icon">
                            <i class="fas fa-tag"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="avgPrice">0</h3>
                            <p>Prix moyen</p>
                        </div>
                    </div>
                    <div class="stat-card trend-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="trendingItems">0</h3>
                            <p>Items en tendance</p>
                        </div>
                    </div>
                </div>

                <!-- Analysis Toggle -->
                <div class="analysis-toggle">
                    <button id="showPriceChart" class="btn btn-outline-primary active" onclick="toggleAnalysis('chart')">
                        <i class="fas fa-chart-line me-2"></i>Analyse des Prix
                    </button>
                    <button id="showItemsTable" class="btn btn-outline-primary" onclick="toggleAnalysis('table')">
                        <i class="fas fa-table me-2"></i>Analyse des Items
                    </button>
                </div>

                <!-- Price Chart Section -->
                <div id="chartSection" class="analysis-section active">
                    <div class="data-section">
                        <div class="data-header">
                            <h5><i class="fas fa-table me-2"></i>Évolution des Prix</h5>
                            <div class="data-controls">
                                <div class="switch-container" id="autoSwitchToggle-parent">
                                    <label class="switch">
                                        <input type="checkbox" id="autoSwitchToggle">
                                        <span class="slider"></span>
                                    </label>
                                    <span class="switch-label text-white ms-2">Auto</span>
                                </div>
                                <div class="btn-group">
                                    <button class="btn btn-outline-secondary btn-sm" id="prevItemBtn" onclick="navigateItem(-1)">
                                        <i class="fas fa-chevron-left"></i> Précédent
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm" id="nextItemBtn" onclick="navigateItem(1)">
                                        Suivant <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                <select id="chartItemSelect" class="form-select">
                                    <option value="">Chargement des items...</option>
                                </select>
                            </div>
                        </div>
                        <div class="data-container">
                            <canvas id="priceChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Items Table Section -->
                <div id="tableSection" class="analysis-section">
                    <div class="data-section">
                        <div class="data-header">
                            <h5><i class="fas fa-table me-2"></i>Analyse des Items</h5>
                            <div class="data-controls">
                                <button class="btn btn-outline-primary" onclick="exportData()">
                                    <i class="fas fa-download me-2"></i>Exporter
                                </button>
                                <button class="btn btn-outline-primary" onclick="restoreAllItems()">
                                    <i class="fas fa-undo me-2"></i>Restaurer tout
                                </button>
                                <button class="btn btn-outline-primary" onclick="refreshData()">
                                    <i class="fas fa-sync me-2"></i>Actualiser
                                </button>
                            </div>
                        </div>
                        <div class="data-container">
                            <table id="itemsTable" class="table table-hover">
                                <thead>
                                    <tr>
                                        <th onclick="sortTable('item_name')" style="cursor: pointer;">
                                            Item <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('price_x1')" style="cursor: pointer;">
                                            Prix x1 <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('price_x10')" style="cursor: pointer;">
                                            Prix x10 <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('price_x100')" style="cursor: pointer;">
                                            Prix x100 <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('arbitrage')" style="cursor: pointer;">
                                            Arbitrage <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('profit_percent')" style="cursor: pointer;">
                                            Profit % <i class="fas fa-sort-down"></i>
                                        </th>
                                        <th onclick="sortTable('investment_cost')" style="cursor: pointer;">
                                            Coût Invest. <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('profit_absolute')" style="cursor: pointer;">
                                            Profit <i class="fas fa-sort"></i>
                                        </th>
                                        <th onclick="sortTable('opportunity_note')" style="cursor: pointer;">
                                            Opportunity Note <i class="fas fa-sort"></i>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="itemsTableBody">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Chargement...</span>
        </div>
        <p class="mt-3">Chargement des données...</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
</body>
</html> 